#!/usr/bin/env python

import colorsys
import time

import rainbowhat

notes = [
	71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 64, 128, 
	71, 128, 69, 128, 69, 128, 69, 128, 69, 128, 69, 128, 69, 128, 66, 128, 
	71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 73, 128, 
	76, 128, 71, 128, 69, 128, 64, 128, 64, 128, 71, 128, 71, 128, 71, 128, 
	71, 128, 64, 128, 71, 128, 69, 128, 69, 128, 69, 128, 62, 128, 69, 128, 
	71, 128, 71, 128, 71, 128, 74, 128, 76, 128, 71, 128, 66, 128, 64, 128, 
	71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 64, 128, 
	71, 128, 69, 128, 69, 128, 69, 128, 69, 128, 69, 128, 69, 128, 66, 128, 
	71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 73, 128, 
	76, 128, 71, 128, 69, 128, 64, 128, 64, 128, 71, 128, 71, 128, 71, 128, 
	71, 128, 64, 128, 71, 128, 69, 128, 69, 128, 69, 128, 62, 128, 69, 128, 
	71, 128, 71, 128, 71, 128, 74, 128, 76, 128, 71, 128, 66, 128, 64, 128, 
	71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 64, 128, 
	71, 128, 69, 128, 69, 128, 69, 128, 69, 128, 69, 128, 69, 128, 66, 128, 
	71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 73, 128, 
	76, 128, 71, 128, 69, 128, 64, 128, 64, 128, 71, 128, 71, 128, 71, 128, 
	71, 128, 64, 128, 71, 128, 69, 128, 69, 128, 69, 128, 62, 128, 69, 128, 
	71, 128, 71, 128, 71, 128, 74, 128, 76, 128, 71, 128, 66, 128, 64, 128, 
	71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 64, 128, 
	71, 128, 69, 128, 69, 128, 69, 128, 69, 128, 69, 128, 69, 128, 66, 128, 
	71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 71, 128, 73, 128, 
	76, 128, 71, 128, 69, 128, 64, 128, 64, 128, 71, 128, 71, 128, 71, 128, 
	71, 128, 64, 128, 71, 128, 69, 128, 69, 128, 69, 128, 62, 128, 69, 128, 
	71, 128, 71, 128, 71, 128, 74, 128, 76, 128, 71, 128, 66, 128, 76, 128
]

times = [
	960, 162, 78, 40, 80, 40, 80, 190, 50, 50, 70, 40, 80, 240, 0, 282, 
	198, 260, 220, 40, 80, 52, 68, 190, 50, 42, 78, 50, 70, 242, 238, 250, 
	230, 190, 50, 40, 80, 40, 80, 200, 40, 50, 70, 50, 70, 240, 0, 242, 
	238, 260, 220, 230, 10, 260, 220, 400, 80, 270, 210, 432, 48, 320, 40, 50, 
	70, 220, 20, 270, 210, 250, 470, 310, 50, 42, 78, 240, 0, 270, 210, 260, 
	462, 308, 50, 50, 80, 270, 200, 240, 0, 270, 210, 242, 238, 260, 460, 300, 
	180, 162, 78, 40, 80, 40, 80, 190, 50, 50, 70, 40, 80, 240, 0, 282, 
	198, 260, 220, 40, 80, 52, 68, 190, 50, 42, 78, 50, 70, 242, 238, 250, 
	230, 190, 50, 40, 80, 40, 80, 200, 40, 50, 70, 50, 70, 240, 0, 242, 
	238, 260, 220, 230, 10, 260, 220, 400, 80, 270, 210, 432, 48, 320, 40, 50, 
	70, 220, 20, 270, 210, 250, 470, 310, 50, 42, 78, 240, 0, 270, 210, 260, 
	462, 308, 50, 50, 80, 270, 200, 240, 0, 270, 210, 242, 238, 260, 460, 300, 
	180, 162, 78, 40, 80, 40, 80, 190, 50, 50, 70, 40, 80, 240, 0, 282, 
	198, 260, 220, 40, 80, 52, 68, 190, 50, 42, 78, 50, 70, 242, 238, 250, 
	230, 190, 50, 40, 80, 40, 80, 200, 40, 50, 70, 50, 70, 240, 0, 242, 
	238, 260, 220, 230, 10, 260, 220, 400, 80, 270, 210, 432, 48, 320, 40, 50, 
	70, 220, 20, 270, 210, 250, 470, 310, 50, 42, 78, 240, 0, 270, 210, 260, 
	462, 308, 50, 50, 80, 270, 200, 240, 0, 270, 210, 242, 238, 260, 460, 300, 
	180, 162, 78, 40, 80, 40, 80, 190, 50, 50, 70, 40, 80, 240, 0, 282, 
	198, 260, 220, 40, 80, 52, 68, 190, 50, 42, 78, 50, 70, 242, 238, 250, 
	230, 190, 50, 40, 80, 40, 80, 200, 40, 50, 70, 50, 70, 240, 0, 242, 
	238, 260, 220, 230, 10, 260, 220, 400, 80, 270, 210, 432, 48, 320, 40, 50, 
	70, 220, 20, 270, 210, 250, 470, 310, 50, 42, 78, 240, 0, 270, 210, 260, 
	462, 308, 50, 50, 80, 270, 200, 240, 0, 270, 210, 242, 238, 260, 460, 300
]

def display_message(message):
    rainbowhat.display.print_str(message)
    rainbowhat.display.show()

@rainbowhat.touch.A.press()
def press_a(channel):
    display_message("AHOY")
    rainbowhat.lights.rgb(1,0,0)

@rainbowhat.touch.B.press()
def press_b(channel):
    display_message("YARR")
    rainbowhat.lights.rgb(0,1,0)

@rainbowhat.touch.C.press()
def press_c(channel):
    display_message("GROG")
    rainbowhat.lights.rgb(0,0,1)

start = time.time()
last_t = None

note_index = 0

current_time = 0
last_time = 0

display_message("WJDK")

try:
    while True:
        if time.time() > last_time + current_time:
            current_note = notes[note_index]
            current_time = times[note_index] / 1000.0
            note_index += 1
            note_index %= len(notes)
            last_time = time.time()
            if current_note == 128 or current_time == 0:
                rainbowhat.buzzer.stop()
                #print("Note Off")
            else:
                rainbowhat.buzzer.midi_note(current_note, current_time)
                #print("Playing Note: {}".format(current_note))

        for x in range(7):
            delta = time.time() * 20
            hue = delta + (x*10)
            hue %= 360 # Clamp to 0-359.9r
            hue /= 360.0 # Scale to 0.0 to 1.0
            r, g, b = [int(c * 255) for c in colorsys.hsv_to_rgb(hue, 1.0, 1.0)]
            rainbowhat.rainbow.set_pixel(6-x, r, g, b, brightness=0.1)

        rainbowhat.rainbow.show()
        time.sleep(0.05)

except KeyboardInterrupt:
    pass
